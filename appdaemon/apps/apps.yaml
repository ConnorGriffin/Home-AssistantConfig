---
lock:
  module: lock
  class: Lock
  trackers:
    - tracker_name: Connor
      tracker: device_tracker.connor_galaxys8
      notification_target: Connor Phone
    - tracker_name: Diana
      tracker: device_tracker.diana_pixel2
      #notification_target: Diana Phone
  # Time in seconds before arming the auto-unlock
  not_home_duration: 300
  lock_entity: lock.front_door_lock
  constrain_input_boolean: input_boolean.smart_unlock_automation

lights:
  module: lights
  class: Lights
  # These defaults can be overridden at the entity level
  # Brightness defaults (used in double-taps and schedules)
  max_brightness: 100
  min_brightness: 10

  # How long after detecting presence before turning on/off
  on_delay: 0
  off_delay: 15

  # How long a light needs to be on/off before another on/off state will be listened for, deals with buggy GE dimmer reporting
  on_threshold: 3
  off_threshold: 3

  brightness_schedule:
    - pct: 75
      start: '9:00:00'
      end: '10:00:00'
    - pct: max_brightness
      start: '12:00:00'
      end: '16:00:00'
    - pct: 70
      start: '18:00:00'
      end: '18:00:00'
    - pct: 15
      start: '21:00:00'
      end: '22:30:00'
    - pct: min_brightness
      start: '00:00:00'
      end: '06:00:00'

  entities:
    - name: connors_office_light

    - name: dianas_office_light
      min_brightness: 8

    - name: bathroom_light
      min_brightness: 15
      motion_sensor: binary_sensor.bathroom_motion
      humidity_sensor: sensor.bathroom_relative_humidity
      humidity_threshold: 65
      off_delay: 570 # +30 built into sensor: 10 minutes
      on_delay: 0

    - name: hallway_light
      min_brightness: 14
      brightness_schedule:
      - pct: 55
        start: '9:00:00'
        end: '10:00:00'
      - pct: max_brightness
        start: '12:00:00'
        end: '16:00:00'
      - pct: 40
        start: '18:00:00'
        end: '18:00:00'
      - pct: min_brightness
        start: '21:00:00'
        end: '06:00:00'

    - name: dining_room_light
      min_brightness: 13
      brightness_schedule:
      - pct: 55
        start: '9:00:00'
        end: '10:00:00'
      - pct: max_brightness
        start: '12:00:00'
        end: '16:00:00'
      - pct: 40
        start: '18:00:00'
        end: '18:00:00'
      - pct: min_brightness
        start: '21:00:00'
        end: '06:00:00'

    - name: bedroom_light
      min_brightness: 8.5
      snooze_minutes: 10
      alarms:
        #- hide_switch_from_groups:
        #    - bedroom
        - alarm_groups:
            - alarm1
            - alarm2
            - alarm3
            - alarm4
            - alarm5
            - "Connor's phone"

alarm_clock:
  module: alarm_clock
  class: AlarmClock
  constrain_input_boolean: input_boolean.alarm_clock_automation

low_battery_alert:
  module: battery
  class: LowBattery
  constrain_input_boolean: input_boolean.low_battery_alert_automation
  level: 15
  entities:
    - zwave.front_door_lock
    - zwave.front_door_sensor
    - zwave.front_window_right_sensor
    - zwave.bathroom_multisensor_6
    - zwave.backyard_door_sensor

ecobee:
  module: ecobee
  class: Ecobee
  # Not used as an app constraint (constrain_input_boolean), used as a config variable
  constrain_boolean: input_boolean.ecobee_auto_home_away_automation
  ecobee_entity: climate.home
  presence_entity: group.all_devices
  # How long to wait before setting a hold/resume based on presence
  home_delay: 0
  not_home_delay: 120
  climate_modes:
    # When away during these, set a home hold
    usually_home:
      - Home
      - Peak
      - Sleep
    # When home during these, set an away hold
    usually_not_home:
      - Away
    # For documentation purposes only, take no action
    no_action:
      - Pre Peak

presence:
  module: presence
  class: Presence
  constrain_input_boolean: input_boolean.room_presence_automation
  rooms:
    - name: Bedroom
      entity: binary_sensor.bedroom_occupancy
    - name: Connor's Office
      entity: binary_sensor.connor_office_occupancy
    - name: Diana's Office
      entity: binary_sensor.diana_office_occupancy

install_dependencies:
  module: install_deps
  class: InstallDeps
  priority: 0
  packages:
    - lxml
    - responses

door_autolock:
  module: door_autolock
  class: DoorAutolock
  constrain_input_boolean: input_boolean.smart_autolock_automation
  closed_seconds: 120
  unlocked_seconds: 120
  doors:
    - door: Front Door
      lock: lock.front_door_lock
      sensor: binary_sensor.front_door
    - door: Back Door
      sensor: binary_sensor.backyard_door

door_window_climate:
  module: door_window_climate
  class: DoorWindowClimate
  constrain_input_boolean: input_boolean.window_door_climate_automation
  # How long to wait before changing climate behaviours after each event
  door_open_seconds: 300
  door_closed_seconds: 30
  window_open_seconds: 0
  window_closed_seconds: 0
  # Thermostat
  climate: climate.home
  # Rooms/areas
  zones:
    - name: Main House
      sensor: sensor.main_house_zone
      mode: any
      windows:
        - binary_sensor.front_window_left
        - binary_sensor.front_window_right
        - binary_sensor.dining_room_window
        - binary_sensor.connors_office_south_window
        - binary_sensor.connors_office_west_window
        - binary_sensor.dianas_office_window
        - binary_sensor.bedroom_window
      doors:
        - binary_sensor.front_door
    - name: Back Room Exterior
      sensor: sensor.back_room_exterior_zone
      mode: any
      doors:
        - binary_sensor.backyard_door
      windows:
        - binary_sensor.back_left_window
        - binary_sensor.back_right_window
        #- binary_sensor.laundry_window
  # Rules - Dependency groups for modifying climate settings
  climate_rules:
    # House is open
    - name: Main House
      mode: all
      dependencies:
        - zone: sensor.main_house_zone
    # Back room and kitchen door are open
    - name: Back Room + Kitchen Door
      mode: all
      dependencies:
        - zone: sensor.back_room_exterior_zone
        - door: binary_sensor.kitchen_door
    # House is open or door to back room is open
    #- name: Main House + Back Room Entry
    #  mode: any
    #  temperature_delta: 5
    #  dependencies:
    #    - zone: sensor.main_house_zone
    #    - door: binary_sensor.kitchen_door
    # House is open, door to back room is open, and door/windows to back yard is open
    - name: Main House + Kitchen Door + Back Room
      mode: all
      dependencies:
        - zone: sensor.main_house_zone
        - zone: sensor.back_room_exterior_zone
        - door: binary_sensor.kitchen_door

home_security:
  module: home_security
  class: HomeSecurity
  constrain_input_boolean: input_boolean.home_security_automation
  # Sensors to create for reporting status in the UI
  armed_sensor: sensor.home_security_armed
  fired_sensor: sensor.home_security_fired
  # Device tracker group
  presence_entity: group.all_devices
  # How many seconds for all to be away before arming the alarm
  arm_delay: 300
  # How many seconds to wait for presence_entity to return home before issuing an alarm
  return_delay: 120
  # How long for a window/door to be open before firing the alarm
  open_duration: 30
  # HTML5 notification targets
  notification_targets:
    - Connor Phone
    - Diana Phone
  # Door and window sensors
  door_window_sensors:
    - binary_sensor.front_window_left
    - binary_sensor.front_window_right
    - binary_sensor.dining_room_window
    - binary_sensor.connors_office_south_window
    - binary_sensor.connors_office_west_window
    - binary_sensor.dianas_office_window
    - binary_sensor.bedroom_window
    - binary_sensor.back_left_window
    - binary_sensor.back_right_window
    - binary_sensor.front_door
    - binary_sensor.backyard_door

window_sensors:
  module: template_sensor
  class: TemplateSensor
  device_class: window
  on_value: '22'
  off_value: '23'
  sensor_name:
    find: '(sensor\.)(.*)_sensor_access_control'
    replace: 'binary_sensor.\2'
  entities:
    - entity: sensor.front_window_left_sensor_access_control
      name: Front Window (Left Half)
    - entity: sensor.front_window_right_sensor_access_control
      name: Front Window (Right Half)
    - sensor.dining_room_window_sensor_access_control
    - entity: sensor.connors_office_south_window_sensor_access_control
      name: "Connor's Office South Window"
    - entity: sensor.connors_office_west_window_sensor_access_control
      name: "Connor's Office West Window"
    - entity: sensor.dianas_office_window_sensor_access_control
      name: "Diana's Office Window"
    - sensor.bedroom_window_sensor_access_control
    - sensor.back_left_window_sensor_access_control
    - sensor.back_right_window_sensor_access_control

door_sensors:
  module: template_sensor
  class: TemplateSensor
  device_class: door
  sensor_name:
    find: '(sensor\.)(.*)_sensor_access_control'
    replace: 'binary_sensor.\2'
  on_value: '22'
  off_value: '23'
  entities:
  - sensor.backyard_door_sensor_access_control
  - sensor.front_door_sensor_access_control
  - sensor.kitchen_door_sensor_access_control


#light_flash:
#  module: light_flash
#  class: LightFlash

#oneshot_test:
#  module: test
#  class: OneshotTest

#notify_test:
#  module: test
#  class: NotifyTest